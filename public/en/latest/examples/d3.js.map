{"version":3,"file":"d3.js","mappings":"kKAOA,MAAMA,UAAoB,IACxBC,YAAYC,GACVC,MAAMD,GAENE,KAAKC,SAAWH,EAAQG,SAExBD,KAAKE,IAAMC,GACRC,OAAOC,SAASC,cAAc,QAC9BC,OAAO,OACPC,MAAM,WAAY,YAErBR,KAAKE,IAAIK,OAAO,QAAQE,MAAMT,KAAKC,UAAUS,KAAK,QAAS,WAC7D,CAEAC,iBACE,MAAO,OACT,CAEAC,OAAOC,GACL,MAAMC,EAAQD,EAAWE,KAAK,GACxBC,EAASH,EAAWE,KAAK,GACzBE,EAAaJ,EAAWK,UAAUD,WAClCE,EAAehB,GAAGiB,cAAcC,MAAM,GAAGC,UAAU,CAAC,EAAG,IAC7D,IAAIC,EAASpB,GAAGqB,UAAUP,WAAWE,GAErC,MAAMM,EAAcF,EAAOG,OAAO1B,KAAKC,UACjC0B,EAAmBF,EAAY,GAAG,GAAKA,EAAY,GAAG,GACtDG,EAAoBH,EAAY,GAAG,GAAKA,EAAY,GAAG,GAEvDI,EAAY1B,GAAG0B,UAAU7B,KAAKC,UAC9B6B,GAAsB,QAAWD,EAAU,GAAIZ,GAC/Cc,GAAoB,QAAWF,EAAU,GAAIZ,GACnD,IAAIe,EAAiBD,EAAkB,GAAKD,EAAoB,GAC5DE,EAAiB,IACnBA,IAAkB,QAASf,EAAWgB,cAExC,MAEMC,EAAkBF,EAAiBL,EACnCQ,GAHkBJ,EAAkB,GAAKD,EAAoB,IAGxBF,EAErCP,EADIe,KAAKC,IAAIH,EAAiBC,GAClBtB,EAAWK,UAAUoB,WAEjCC,GAAS,SAAS,QAAU1B,EAAW2B,QAASvB,GAChDwB,EAA0C,KAAhC5B,EAAWK,UAAUwB,SAAkBN,KAAKO,GAgB5D,OAdAxB,EACGE,MAAMA,GACNkB,OAAOA,GACPjB,UAAU,CAACR,EAAQ,EAAGE,EAAS,IAC/ByB,MAAMA,GAETlB,EAASA,EAAON,WAAWE,GAC3BI,EAAOvB,KAAKC,UAEZD,KAAKE,IAAIQ,KAAK,QAASI,GACvBd,KAAKE,IAAIQ,KAAK,SAAUM,GAExBhB,KAAKE,IAAIE,OAAO,QAAQM,KAAK,IAAKa,GAE3BvB,KAAKE,IAAI0C,MAClB,EAGF,MAAMC,EAAM,IAAI,IAAI,CAClBC,OAAQ,CACN,IAAI,IAAU,CACZC,OAAQ,IAAI,IAAO,CACjBC,MAAO,kBAIbC,OAAQ,MACRC,KAAM,IAAI,KAAK,CACbX,QAAQ,QAAW,EAAE,GAAI,KACzBY,KAAM,MAOVhD,GAAGiD,KAAK,yBAAyBC,MAAK,SAAUC,GAC9C,MAAMN,EAAQ,IAAIpD,EAAY,CAC5BK,SAAUsD,SAASC,QAAQF,EAAIA,EAAGG,QAAQC,YAG5Cb,EAAIc,SAASX,EACf,G","sources":["webpack:///./d3.js"],"sourcesContent":["import Map from '../src/ol/Map.js';\nimport Stamen from '../src/ol/source/Stamen.js';\nimport View from '../src/ol/View.js';\nimport {Layer, Tile as TileLayer} from '../src/ol/layer.js';\nimport {fromLonLat, toLonLat} from '../src/ol/proj.js';\nimport {getCenter, getWidth} from '../src/ol/extent.js';\n\nclass CanvasLayer extends Layer {\n  constructor(options) {\n    super(options);\n\n    this.features = options.features;\n\n    this.svg = d3\n      .select(document.createElement('div'))\n      .append('svg')\n      .style('position', 'absolute');\n\n    this.svg.append('path').datum(this.features).attr('class', 'boundary');\n  }\n\n  getSourceState() {\n    return 'ready';\n  }\n\n  render(frameState) {\n    const width = frameState.size[0];\n    const height = frameState.size[1];\n    const projection = frameState.viewState.projection;\n    const d3Projection = d3.geoMercator().scale(1).translate([0, 0]);\n    let d3Path = d3.geoPath().projection(d3Projection);\n\n    const pixelBounds = d3Path.bounds(this.features);\n    const pixelBoundsWidth = pixelBounds[1][0] - pixelBounds[0][0];\n    const pixelBoundsHeight = pixelBounds[1][1] - pixelBounds[0][1];\n\n    const geoBounds = d3.geoBounds(this.features);\n    const geoBoundsLeftBottom = fromLonLat(geoBounds[0], projection);\n    const geoBoundsRightTop = fromLonLat(geoBounds[1], projection);\n    let geoBoundsWidth = geoBoundsRightTop[0] - geoBoundsLeftBottom[0];\n    if (geoBoundsWidth < 0) {\n      geoBoundsWidth += getWidth(projection.getExtent());\n    }\n    const geoBoundsHeight = geoBoundsRightTop[1] - geoBoundsLeftBottom[1];\n\n    const widthResolution = geoBoundsWidth / pixelBoundsWidth;\n    const heightResolution = geoBoundsHeight / pixelBoundsHeight;\n    const r = Math.max(widthResolution, heightResolution);\n    const scale = r / frameState.viewState.resolution;\n\n    const center = toLonLat(getCenter(frameState.extent), projection);\n    const angle = (-frameState.viewState.rotation * 180) / Math.PI;\n\n    d3Projection\n      .scale(scale)\n      .center(center)\n      .translate([width / 2, height / 2])\n      .angle(angle);\n\n    d3Path = d3Path.projection(d3Projection);\n    d3Path(this.features);\n\n    this.svg.attr('width', width);\n    this.svg.attr('height', height);\n\n    this.svg.select('path').attr('d', d3Path);\n\n    return this.svg.node();\n  }\n}\n\nconst map = new Map({\n  layers: [\n    new TileLayer({\n      source: new Stamen({\n        layer: 'watercolor',\n      }),\n    }),\n  ],\n  target: 'map',\n  view: new View({\n    center: fromLonLat([-97, 38]),\n    zoom: 4,\n  }),\n});\n\n/**\n * Load the topojson data and create an ol/layer/Image for that data.\n */\nd3.json('data/topojson/us.json').then(function (us) {\n  const layer = new CanvasLayer({\n    features: topojson.feature(us, us.objects.counties),\n  });\n\n  map.addLayer(layer);\n});\n"],"names":["CanvasLayer","constructor","options","super","this","features","svg","d3","select","document","createElement","append","style","datum","attr","getSourceState","render","frameState","width","size","height","projection","viewState","d3Projection","geoMercator","scale","translate","d3Path","geoPath","pixelBounds","bounds","pixelBoundsWidth","pixelBoundsHeight","geoBounds","geoBoundsLeftBottom","geoBoundsRightTop","geoBoundsWidth","getExtent","widthResolution","heightResolution","Math","max","resolution","center","extent","angle","rotation","PI","node","map","layers","source","layer","target","view","zoom","json","then","us","topojson","feature","objects","counties","addLayer"],"sourceRoot":""}