{"version":3,"file":"measure-style.js","mappings":"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","sources":["webpack:///./measure-style.js"],"sourcesContent":["import Map from '../src/ol/Map.js';\nimport View from '../src/ol/View.js';\nimport {\n  Circle as CircleStyle,\n  Fill,\n  RegularShape,\n  Stroke,\n  Style,\n  Text,\n} from '../src/ol/style.js';\nimport {Draw, Modify} from '../src/ol/interaction.js';\nimport {LineString, Point} from '../src/ol/geom.js';\nimport {OSM, Vector as VectorSource} from '../src/ol/source.js';\nimport {Tile as TileLayer, Vector as VectorLayer} from '../src/ol/layer.js';\nimport {getArea, getLength} from '../src/ol/sphere.js';\n\nconst typeSelect = document.getElementById('type');\nconst showSegments = document.getElementById('segments');\nconst clearPrevious = document.getElementById('clear');\n\nconst style = new Style({\n  fill: new Fill({\n    color: 'rgba(255, 255, 255, 0.2)',\n  }),\n  stroke: new Stroke({\n    color: 'rgba(0, 0, 0, 0.5)',\n    lineDash: [10, 10],\n    width: 2,\n  }),\n  image: new CircleStyle({\n    radius: 5,\n    stroke: new Stroke({\n      color: 'rgba(0, 0, 0, 0.7)',\n    }),\n    fill: new Fill({\n      color: 'rgba(255, 255, 255, 0.2)',\n    }),\n  }),\n});\n\nconst labelStyle = new Style({\n  text: new Text({\n    font: '14px Calibri,sans-serif',\n    fill: new Fill({\n      color: 'rgba(255, 255, 255, 1)',\n    }),\n    backgroundFill: new Fill({\n      color: 'rgba(0, 0, 0, 0.7)',\n    }),\n    padding: [3, 3, 3, 3],\n    textBaseline: 'bottom',\n    offsetY: -15,\n  }),\n  image: new RegularShape({\n    radius: 8,\n    points: 3,\n    angle: Math.PI,\n    displacement: [0, 10],\n    fill: new Fill({\n      color: 'rgba(0, 0, 0, 0.7)',\n    }),\n  }),\n});\n\nconst tipStyle = new Style({\n  text: new Text({\n    font: '12px Calibri,sans-serif',\n    fill: new Fill({\n      color: 'rgba(255, 255, 255, 1)',\n    }),\n    backgroundFill: new Fill({\n      color: 'rgba(0, 0, 0, 0.4)',\n    }),\n    padding: [2, 2, 2, 2],\n    textAlign: 'left',\n    offsetX: 15,\n  }),\n});\n\nconst modifyStyle = new Style({\n  image: new CircleStyle({\n    radius: 5,\n    stroke: new Stroke({\n      color: 'rgba(0, 0, 0, 0.7)',\n    }),\n    fill: new Fill({\n      color: 'rgba(0, 0, 0, 0.4)',\n    }),\n  }),\n  text: new Text({\n    text: 'Drag to modify',\n    font: '12px Calibri,sans-serif',\n    fill: new Fill({\n      color: 'rgba(255, 255, 255, 1)',\n    }),\n    backgroundFill: new Fill({\n      color: 'rgba(0, 0, 0, 0.7)',\n    }),\n    padding: [2, 2, 2, 2],\n    textAlign: 'left',\n    offsetX: 15,\n  }),\n});\n\nconst segmentStyle = new Style({\n  text: new Text({\n    font: '12px Calibri,sans-serif',\n    fill: new Fill({\n      color: 'rgba(255, 255, 255, 1)',\n    }),\n    backgroundFill: new Fill({\n      color: 'rgba(0, 0, 0, 0.4)',\n    }),\n    padding: [2, 2, 2, 2],\n    textBaseline: 'bottom',\n    offsetY: -12,\n  }),\n  image: new RegularShape({\n    radius: 6,\n    points: 3,\n    angle: Math.PI,\n    displacement: [0, 8],\n    fill: new Fill({\n      color: 'rgba(0, 0, 0, 0.4)',\n    }),\n  }),\n});\n\nconst segmentStyles = [segmentStyle];\n\nconst formatLength = function (line) {\n  const length = getLength(line);\n  let output;\n  if (length > 100) {\n    output = Math.round((length / 1000) * 100) / 100 + ' km';\n  } else {\n    output = Math.round(length * 100) / 100 + ' m';\n  }\n  return output;\n};\n\nconst formatArea = function (polygon) {\n  const area = getArea(polygon);\n  let output;\n  if (area > 10000) {\n    output = Math.round((area / 1000000) * 100) / 100 + ' km\\xB2';\n  } else {\n    output = Math.round(area * 100) / 100 + ' m\\xB2';\n  }\n  return output;\n};\n\nconst raster = new TileLayer({\n  source: new OSM(),\n});\n\nconst source = new VectorSource();\n\nconst modify = new Modify({source: source, style: modifyStyle});\n\nlet tipPoint;\n\nfunction styleFunction(feature, segments, drawType, tip) {\n  const styles = [style];\n  const geometry = feature.getGeometry();\n  const type = geometry.getType();\n  let point, label, line;\n  if (!drawType || drawType === type) {\n    if (type === 'Polygon') {\n      point = geometry.getInteriorPoint();\n      label = formatArea(geometry);\n      line = new LineString(geometry.getCoordinates()[0]);\n    } else if (type === 'LineString') {\n      point = new Point(geometry.getLastCoordinate());\n      label = formatLength(geometry);\n      line = geometry;\n    }\n  }\n  if (segments && line) {\n    let count = 0;\n    line.forEachSegment(function (a, b) {\n      const segment = new LineString([a, b]);\n      const label = formatLength(segment);\n      if (segmentStyles.length - 1 < count) {\n        segmentStyles.push(segmentStyle.clone());\n      }\n      const segmentPoint = new Point(segment.getCoordinateAt(0.5));\n      segmentStyles[count].setGeometry(segmentPoint);\n      segmentStyles[count].getText().setText(label);\n      styles.push(segmentStyles[count]);\n      count++;\n    });\n  }\n  if (label) {\n    labelStyle.setGeometry(point);\n    labelStyle.getText().setText(label);\n    styles.push(labelStyle);\n  }\n  if (\n    tip &&\n    type === 'Point' &&\n    !modify.getOverlay().getSource().getFeatures().length\n  ) {\n    tipPoint = geometry;\n    tipStyle.getText().setText(tip);\n    styles.push(tipStyle);\n  }\n  return styles;\n}\n\nconst vector = new VectorLayer({\n  source: source,\n  style: function (feature) {\n    return styleFunction(feature, showSegments.checked);\n  },\n});\n\nconst map = new Map({\n  layers: [raster, vector],\n  target: 'map',\n  view: new View({\n    center: [-11000000, 4600000],\n    zoom: 15,\n  }),\n});\n\nmap.addInteraction(modify);\n\nlet draw; // global so we can remove it later\n\nfunction addInteraction() {\n  const drawType = typeSelect.value;\n  const activeTip =\n    'Click to continue drawing the ' +\n    (drawType === 'Polygon' ? 'polygon' : 'line');\n  const idleTip = 'Click to start measuring';\n  let tip = idleTip;\n  draw = new Draw({\n    source: source,\n    type: drawType,\n    style: function (feature) {\n      return styleFunction(feature, showSegments.checked, drawType, tip);\n    },\n  });\n  draw.on('drawstart', function () {\n    if (clearPrevious.checked) {\n      source.clear();\n    }\n    modify.setActive(false);\n    tip = activeTip;\n  });\n  draw.on('drawend', function () {\n    modifyStyle.setGeometry(tipPoint);\n    modify.setActive(true);\n    map.once('pointermove', function () {\n      modifyStyle.setGeometry();\n    });\n    tip = idleTip;\n  });\n  modify.setActive(true);\n  map.addInteraction(draw);\n}\n\ntypeSelect.onchange = function () {\n  map.removeInteraction(draw);\n  addInteraction();\n};\n\naddInteraction();\n\nshowSegments.onchange = function () {\n  vector.changed();\n  draw.getOverlay().changed();\n};\n"],"names":["typeSelect","document","getElementById","showSegments","clearPrevious","style","fill","color","stroke","lineDash","width","image","radius","labelStyle","text","font","backgroundFill","padding","textBaseline","offsetY","points","angle","Math","PI","displacement","tipStyle","textAlign","offsetX","modifyStyle","segmentStyle","segmentStyles","formatLength","line","length","output","round","raster","source","modify","tipPoint","styleFunction","feature","segments","drawType","tip","styles","geometry","getGeometry","type","getType","point","label","getInteriorPoint","polygon","area","formatArea","getCoordinates","getLastCoordinate","count","forEachSegment","a","b","segment","push","clone","segmentPoint","getCoordinateAt","setGeometry","getText","setText","getOverlay","getSource","getFeatures","vector","checked","map","layers","target","view","center","zoom","draw","addInteraction","value","activeTip","idleTip","on","clear","setActive","once","onchange","removeInteraction","changed"],"sourceRoot":""}